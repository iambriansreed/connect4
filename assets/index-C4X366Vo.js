(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();const P={player1:"Red Wins!",player2:"Yellow Wins!"},O=6,L=7,A=7,C=[{name:"top to bottom",points:[[0,3],[0,2],[0,1],[0,0],[0,-1],[0,-2],[0,-3]]},{name:"left to right",points:[[-3,0],[-2,0],[-1,0],[0,0],[1,0],[2,0],[3,0]]},{name:"top left to bottom right",points:[[-3,3],[-2,2],[-1,1],[0,0],[1,-1],[2,-2],[3,-3]]},{name:"bottom left to top right",points:[[-3,-3],[-2,-2],[-1,-1],[0,0],[1,1],[2,2],[3,3]]}],k=(t,e)=>t>=0&&t<L&&e>=0&&e<O;globalThis.aiLog=[];const m=(...t)=>{app.debug&&console.log(...t),globalThis.aiLog[globalThis.aiLog.length-1].push(t)},M=()=>{app.debug&&console.clear(),globalThis.aiLog.push([])},g={unavailable:"u",occupied:"o",available:"a",next:"n",outOfBounds:"x"},q={match4:100,match3:80,match2:60,match4opponent:-100,match3opponent:-80,match2opponent:-60},Y=[{key:"match4",matches:["aooo","oooa","oaoo","ooao"]},{key:"match3",matches:["aoo","ooa","oao"]},{key:"match2",matches:["ao","oa"]},{key:"match4opponent",matches:["nooo","ooon","onoo","oono"]},{key:"match3opponent",matches:["noo","oon","ono"]},{key:"match2opponent",matches:["no","on"]}];function N(){const t=Array.from({length:L},(s,l)=>state.availableY(l));M(),m(state.player+" is playing"),m("availableYs",t);const e=s=>{var c;const l=[];if(!s)return l;for(const d of C){let p="";const b=[];for(const[h,v]of d.points){const[u,f]=[s.x+h,s.y+v];if(b.push(u),!k(u,f)){p+=g.outOfBounds;continue}if(((c=state.getPlay(u,f))==null?void 0:c.player)===s.player){p+=g.occupied;continue}const y=t[u];if(y!==null){if(y===f){p+=g.available;continue}if(y+1===f){p+=g.next;continue}}p+=g.unavailable}for(const{key:h,matches:v}of Y)for(const u of v){const f=p.indexOf(u);if(f>-1){const y=p.indexOf(u);let w=u.indexOf("a");const T=y+w;l.push({value:q[h],x:b[T],name:h,encoding:p,matches:f,aIndex:w,matchIndex:y,availablePoint:T,points:b})}}}return l},a=state.player;if(!t.filter(U).length)throw new Error("No available moves");const n=state.plays.flatMap(s=>{const l=s.player===a?"offensive":"defensive";return e(s).map(c=>({...c,type:l,value:c.value+(l==="defensive"?-10:0)}))}).flat().sort((s,l)=>l.value-s.value);if(m(n),n.length===0)return 3;const r=n.filter(s=>s.value<0),o=n.find(s=>s.value>0&&!r.some(l=>l.x===s.x));if(o)return m("bestMove",o),o.x;const i=t.filter(s=>!n.some(l=>l.x===s));return m("bestAvailableYs",i),i.length?i[0]:(m("No available moves without a negative value."),n[0].x)}async function D(t,e,a,n){return new Promise(r=>{const o=Object.keys(e).map(i=>`${i} ${Math.round(a)}ms ${n}`).join(",");t.style.transition=o,setTimeout(()=>{Object.assign(t.style,e)},1),setTimeout(()=>{t.style.transition="",r()},a+50)})}async function _(t,e){return new Promise(a=>{setTimeout(()=>{e==null||e(),a()},t)})}function E(...t){t.forEach(e=>e.style.display="inherit")}function x(...t){t.forEach(e=>e.style.display="none")}function B(t){let e=[];for(const a of C){e=[];const n=t.at(-1);for(let r=0;r<A;r++){const[o,i]=a.points[r],[s,l]=[n.x+o,n.y+i],c=t.getPlay(s,l);if((c==null?void 0:c.player)===n.player){if(e.push(c),e.length===4)return e}else{const d=A-r-1;if(e=[],d<4)continue}}}return null}const W=()=>!!B(state),I=()=>state.playsLength===64,R=()=>W()?(app.winMessage.innerText=P[state.player],E(app.gameOver),state.dropping(!1),!0):I()?(E(app.gameTie),state.dropping(!1),!0):(state.togglePlayer(),state.dropping(!1),state.isPlayerAi&&S(N()),!1),S=async t=>{if(state.isDropping)return;const e=state.availableY(t);if(typeof e!="number")throw new Error("Invalid move: "+JSON.stringify(e));state.dropping(!0);const a=app.nextChecker.getBoundingClientRect().top;app.nextChecker.style.opacity="0";{const n=app.nextChecker.cloneNode(!0);app.column[t].appendChild(n),n.setAttribute("style","");const r=n.offsetTop+n.getBoundingClientRect().height;n.style.top=a+"px",n.style.position="fixed";const i=(Math.abs(e-O)+1)*75;n.style.transition="all "+i+"ms cubic-bezier(0.33333, 0, 0.66667, 0.33333)",n.style.transform="translateY("+r+"px)",await _(i,()=>{n.setAttribute("style","position: relative;")})}app.nextChecker.classList.toggle("player1"),app.nextChecker.classList.toggle("player2"),app.nextChecker.style.opacity="1",state.addPlay(t,e,state.player),R()},z=()=>{state.isDropping||(x(app.gameStart),state.isPlayerAi&&S(N()))},G=async()=>{if(app.nextChecker.classList.replace("player2","player1"),state.isDropping)return;app.columns.style.top="0px";const t=Math.round(window.outerHeight+window.outerHeight/2);D(app.columns,{transform:"translateY("+t+"px)"},t/2.5,"cubic-bezier(0.33333, 0, 0.66667, 0.33333)").then(()=>{app.columns.style.transform="",app.columns.style.transition="",app.columns.style.top="0px",[...app.columns.children].forEach(e=>e.innerHTML=""),state.reset(),x(app.gameOver),x(app.gameTie)})};function H(t){app.nextChecker.style.left=t*app.size.clientWidth+"px"}function U(t,e,a){return t!=null}function j(t){const e=[];let a={},n=0,r="player1";return{togglePlayer(){r=r==="player1"?"player2":"player1"},reset(){e.length=0,a={},n=0},get isPlayerAi(){return t.includes(r)},get plays(){return[...e]},dropping(o=!0){n=n+(o?1:-1)},get isDropping(){return n>0},get player(){return r},get playsLength(){return e.length},addPlay(o,i,s){e.push({x:o,y:i,player:s}),a[o]=a[o]||{},a[o][i]=e.length-1},at(o){return o<0?e[e.length+o]:e[o]},getPlay(o,i){var s;return a?e[(s=a[o])==null?void 0:s[i]]:null},availableY(o){const i=Object.keys(a[o]||{}).length;return i<O?i:null}}}function F(){globalThis.state=j(["player2"]);const t=document.querySelector("#board .columns"),e=globalThis.app={debug:!1,board:document.querySelector("#board"),columns:t,size:document.querySelector("#size"),gameOver:document.querySelector("#game-over"),gameTie:document.querySelector("#game-tie"),gameStart:document.querySelector("#game-start"),resetButtons:Array.from(document.querySelectorAll('[data-id="reset-btn"]')),startButton:document.querySelector("#start-btn"),buttons:Array.from(document.querySelectorAll("#board button")),spacesWrapper:Array.from(document.querySelectorAll("#board .spaces")),winMessage:document.querySelector("#win-message"),nextChecker:document.querySelector("#board .next .checker"),column:[...t.children]};e.column.forEach((a,n)=>{a.onclick=()=>S(n),a.onmouseover=()=>H(n)}),e.startButton.onclick=z,e.resetButtons.forEach(a=>a.onclick=G)}addEventListener("load",F);
