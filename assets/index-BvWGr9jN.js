(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();const k={player1:"Red Wins!",player2:"Yellow Wins!"},M=6,T=7,O=7,w=[{name:"top to bottom",points:[[0,3],[0,2],[0,1],[0,0],[0,-1],[0,-2],[0,-3]]},{name:"left to right",points:[[-3,0],[-2,0],[-1,0],[0,0],[1,0],[2,0],[3,0]]},{name:"top left to bottom right",points:[[-3,3],[-2,2],[-1,1],[0,0],[1,-1],[2,-2],[3,-3]]},{name:"bottom left to top right",points:[[-3,-3],[-2,-2],[-1,-1],[0,0],[1,1],[2,2],[3,3]]}],A=(t,e)=>t>=0&&t<T&&e>=0&&e<M;globalThis.aiLog=[];const d={unavailable:"u",occupied:"o",available:"a",next:"n",outOfBounds:"x"},C={match4:["aooo","oooa","oaoo","ooao"],match3:["aoo","ooa","oao"],match2:["ao","oa"],match4Next:["nooo","ooon","onoo","oono"],match3Next:["noo","oon","ono"],match2Next:["no","on"]},L=[{key:"match4",type:"offensive",value:100},{key:"match4",type:"defensive",value:90},{key:"match3",type:"defensive",value:80},{key:"match3",type:"offensive",value:70},{key:"match2",type:"offensive",value:60},{key:"match2",type:"defensive",value:50},{key:"match3Next",type:"defensive",value:-1},{key:"match4Next",type:"offensive",value:-1}];function E(){const t=Array.from({length:T},(o,i)=>state.availableY(i)),e=o=>{const i={goodMoves:[],badMoves:[]},u=(o==null?void 0:o.player)===state.player?"offensive":"defensive";if(!o)return i;for(const p of w){let f="",v=[];p.points.forEach(([h,x])=>{const[l,c]=[o.x+h,o.y+x];v.push(l),f+=(()=>{var g;if(!A(l,c))return d.outOfBounds;if(((g=state.getPlay(l,c))==null?void 0:g.player)===o.player)return d.occupied;const y=t[l];return y===c?d.available:y!==null&&y+1===c?d.next:d.unavailable})()});for(const{key:h,value:x}of L.filter(l=>l.type===u))for(const l of C[h]){const c=f.indexOf(l);if(c==-1)continue;let y=l.indexOf(d.available),g=l.indexOf(d.next);if(y>-1){const m=c+y;i.goodMoves.push({value:x,x:v[m],name:h,type:u,extra:{encoding:f,aIndex:y,matchIndex:c,availablePoint:m,xPoints:v}})}if(g>-1){const m=c+g;i.badMoves.push({x:v[m],name:h,type:u,extra:{encoding:f,aIndex:y,matchIndex:c,xToAvoid:m}})}}}return i};if(!t.filter(G).length)throw new Error("No available moves");const s=[],a=[];if(state.plays.forEach(o=>{const i=e(o);s.push(...i.goodMoves),a.push(...i.badMoves)}),s.sort((o,i)=>i.value-o.value),s.length===0){const o=t.reduce((u,p,f)=>(p!==null&&u.push(f),u),[]),i=Y(0,o.length-1);return o[i]}const r=s.find(o=>!a.some(i=>i.x===o.x));if(r)return r.x;const n=t.filter(o=>!s.some(i=>i.x===o));return n.length?n[0]:s[0].x}async function P(t,e,s,a){return new Promise(r=>{const n=Object.keys(e).map(o=>`${o} ${Math.round(s)}ms ${a}`).join(",");t.style.transition=n,setTimeout(()=>{Object.assign(t.style,e)},1),setTimeout(()=>{t.style.transition="",r()},s+50)})}async function q(t,e){return new Promise(s=>{setTimeout(()=>{e==null||e(),s()},t)})}function Y(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}function S(...t){t.forEach(e=>e.style.display="inherit")}function b(...t){t.forEach(e=>e.style.display="none")}function I(t){let e=[];for(const s of w){e=[];const a=t.at(-1);for(let r=0;r<O;r++){const[n,o]=s.points[r],[i,u]=[a.x+n,a.y+o],p=t.getPlay(i,u);if((p==null?void 0:p.player)===a.player){if(e.push(p),e.length===4)return e}else{const f=O-r-1;if(e=[],f<4)continue}}}return null}const R=()=>!!I(state),B=()=>state.playsLength===64,D=()=>R()?(app.winMessage.innerText=k[state.player],S(app.gameOver),state.dropping(!1),!0):B()?(S(app.gameTie),state.dropping(!1),!0):(state.togglePlayer(),state.dropping(!1),state.isPlayerAi&&N(E()),!1),N=async t=>{if(state.isDropping)return;const e=state.availableY(t);if(typeof e!="number")throw new Error("Invalid move: "+JSON.stringify(e));state.dropping(!0);const s=app.nextChecker.getBoundingClientRect().top;app.nextChecker.style.opacity="0";{const a=app.nextChecker.cloneNode(!0);app.column[t].appendChild(a),a.setAttribute("style","");const r=a.offsetTop+a.getBoundingClientRect().height;a.style.top=s+"px",a.style.position="fixed";const o=(Math.abs(e-M)+1)*75;a.style.transition="all "+o+"ms cubic-bezier(0.33333, 0, 0.66667, 0.33333)",a.style.transform="translateY("+r+"px)",await q(o,()=>{a.setAttribute("style","position: relative;")})}app.nextChecker.classList.toggle("player1"),app.nextChecker.classList.toggle("player2"),app.nextChecker.style.opacity="1",state.addPlay(t,e,state.player),D()},W=()=>{state.isDropping||(b(app.gameStart),state.isPlayerAi&&N(E()))},_=async()=>{if(app.nextChecker.classList.replace("player2","player1"),state.isDropping)return;app.columns.style.top="0px";const t=Math.round(window.outerHeight+window.outerHeight/2);P(app.columns,{transform:"translateY("+t+"px)"},t/2.5,"cubic-bezier(0.33333, 0, 0.66667, 0.33333)").then(()=>{app.columns.style.transform="",app.columns.style.transition="",app.columns.style.top="0px",[...app.columns.children].forEach(e=>e.innerHTML=""),state.reset(),b(app.gameOver),b(app.gameTie)})};function z(t){app.nextChecker.style.left=t*app.size.clientWidth+"px"}function G(t,e,s){return t!=null}function j(t){const e=[];let s={},a=0,r="player1";return{togglePlayer(){r=r==="player1"?"player2":"player1"},reset(){e.length=0,s={},a=0},get isPlayerAi(){return t.includes(r)},get plays(){return[...e]},dropping(n=!0){a=a+(n?1:-1)},get isDropping(){return a>0},get player(){return r},get playsLength(){return e.length},addPlay(n,o,i){e.push({x:n,y:o,player:i}),s[n]=s[n]||{},s[n][o]=e.length-1},at(n){return n<0?e[e.length+n]:e[n]},getPlay(n,o){var i;return s?e[(i=s[n])==null?void 0:i[o]]:null},availableY(n){const o=Object.keys(s[n]||{}).length;return o<M?o:null}}}function F(){globalThis.state=j(["player2"]);const t=document.querySelector("#board .columns"),e=globalThis.app={debug:!1,board:document.querySelector("#board"),columns:t,size:document.querySelector("#size"),gameOver:document.querySelector("#game-over"),gameTie:document.querySelector("#game-tie"),gameStart:document.querySelector("#game-start"),restartButtons:Array.from(document.querySelectorAll("[data-restart]")),startButton:document.querySelector("#start-btn"),buttons:Array.from(document.querySelectorAll("#board button")),spacesWrapper:Array.from(document.querySelectorAll("#board .spaces")),winMessage:document.querySelector("#win-message"),nextChecker:document.querySelector("#board .next .checker"),column:[...t.children]};e.column.forEach((s,a)=>{s.onclick=()=>N(a),s.onmouseover=()=>z(a)}),e.startButton.onclick=W,e.restartButtons.forEach(s=>s.onclick=_)}addEventListener("load",F);
