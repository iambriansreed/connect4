(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const C={human:"You have won human!",robot:"Humans drool, robots rule!"},b=6,S=7,T=[{name:"|",points:[[0,3],[0,2],[0,1],[0,0],[0,-1],[0,-2],[0,-3]]},{name:"--",points:[[-3,0],[-2,0],[-1,0],[0,0],[1,0],[2,0],[3,0]]},{name:"\\",points:[[-3,3],[-2,2],[-1,1],[0,0],[1,-1],[2,-2],[3,-3]]},{name:"/",points:[[-3,-3],[-2,-2],[-1,-1],[0,0],[1,1],[2,2],[3,3]]}],I=(e,t)=>e>=0&&e<S&&t>=0&&t<b;globalThis.aiLog=[];const y={unavailable:"u",occupied:"o",available:"a",next:"n",outOfBounds:"x"},q={match4:["aooo","oooa","oaoo","ooao"],match3:["aoo","ooa","oao"],match2:["ao","oa"],match4Next:["nooo","ooon","onoo","oono"],match3Next:["noo","oon","ono"],match2Next:["no","on"]},Y=[{key:"match4",type:"offensive",value:100},{key:"match4",type:"defensive",value:90},{key:"match3",type:"defensive",value:80},{key:"match3",type:"offensive",value:70},{key:"match2",type:"offensive",value:60},{key:"match2",type:"defensive",value:50},{key:"match3Next",type:"defensive",value:-1},{key:"match4Next",type:"offensive",value:-1}];function x(){const e=[];e.push(state.player);const t=Array.from({length:S},(a,o)=>state.availableY(o)),n=a=>{const o={goodMoves:[],badMoves:[]},l=(a==null?void 0:a.player)===state.player?"offensive":"defensive";if(!a)return o;for(const c of T){let h="",m=[];c.points.forEach(([d,w])=>{const[u,p]=[a.x+d,a.y+w];m.push(u),h+=(()=>{var g;if(!I(u,p))return y.outOfBounds;if(((g=state.getPlay(u,p))==null?void 0:g.player)===a.player)return y.occupied;const f=t[u];return f===p?y.available:f!==null&&f+1===p?y.next:y.unavailable})()});for(const{key:d,value:w}of Y.filter(u=>u.type===l))for(const u of q[d]){const p=h.indexOf(u);if(p==-1)continue;let f=u.indexOf(y.available),g=u.indexOf(y.next);const N=p+f,O=p+g,P={encoding:h,aIndex:f,matchIndex:p,availableX:N,xToAvoid:O,xPoints:m};f>-1&&o.goodMoves.push({value:w,x:m[N],name:d,type:l,extra:P}),g>-1&&o.badMoves.push({x:m[O],name:d,type:l,extra:P})}}return o};if(!t.filter(j).length)throw aiLog.push(["No available moves",t]),new Error("No available moves");const s=[],r=[];state.plays.forEach(a=>{const o=n(a);s.push(...o.goodMoves),r.push(...o.badMoves)}),s.sort((a,o)=>o.value-a.value),e.push({goodMoves:s,badMoves:r});const i=()=>{if(s.length===0){const l=t.reduce((h,m,d)=>(m!==null&&h.push(d),h),[]),c=B(0,l.length-1);return e.push("random",{availableXs:l}),l[c]}if(s[0].value===100)return e.push("win the game"),s[0].x;if(s[0].value===90)return e.push("save the game"),s[0].x;const a=s.find(l=>!r.some(c=>c.x===l.x));if(a)return e.push(["best non bad move",{bestMove:a}]),a.x;const o=t.find(l=>l!==null&&s.some(c=>c.x===l));return o?(e.push(["bestAvailableY",o]),o):(e.push(["goodMoves[0].x",s]),s[0].x)};return aiLog.push(e),i()}async function D(e,t,n,s){return new Promise(r=>{const i=Object.keys(t).map(a=>`${a} ${Math.round(n)}ms ${s}`).join(",");e.style.transition=i,setTimeout(()=>{Object.assign(e.style,t)},1),setTimeout(()=>{e.style.transition="",r()},n+50)})}async function M(e,t){return new Promise(n=>{setTimeout(()=>{t==null||t(),n()},e)})}function B(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}function A(...e){e.forEach(t=>t.classList.remove("show"))}function R(){let e=[];for(const t of T){e=[];const n=state.at(-1);for(const[s,[r,i]]of t.points.entries()){const[a,o]=[n.x+r,n.y+i],l=state.getPlay(a,o);if((l==null?void 0:l.player)===n.player){if(e.push(l),e.length===4)return e}else{const c=t.points.length-s-1;if(e=[],c<4)continue}}}return null}const _=()=>state.playsLength===b*S,k=({x:e,y:t})=>`c-${e}-${t}`,G=async()=>{const e=R();return e?(app.winMessage.innerText=C[state.isPlayerAi?"robot":"human"],e.forEach(t=>{var n;(n=document.querySelector("#"+k(t)))==null||n.classList.add("blink")}),await M(2e3),!state.debug&&L(app.gameOver),!0):_()?(!state.debug&&L(app.gameTie),!0):(state.togglePlayer(),state.dropping(!1),state.isPlayerAi&&v(x()),!1)};async function W(e){state.isDropping||state.isPlayerAi||await v(e)}const E=({player:e,...t})=>{const n=app.nextChecker.cloneNode(!0);return app.column[t.x].appendChild(n),n.setAttribute("style",""),n.classList.remove("player1","player2"),n.classList.add(e),n.id=k(t),state.debug&&(n.innerText=state.playsLength.toString()),n},v=async(e,t=!1)=>{if(state.isDropping)return;const n=state.availableY(e);if(typeof n!="number")throw new Error("Invalid move: "+JSON.stringify(n));state.dropping(!0);const s=app.nextChecker.getBoundingClientRect().top;app.nextChecker.style.opacity="0";const r={x:e,y:n,player:state.player};state.addPlay(r);{const i=E(r),a=i.offsetTop+i.getBoundingClientRect().height;if(!t){i.style.top=s+"px",i.style.position="fixed";const l=(Math.abs(n-b)+1)*75;i.style.transition="all "+l+"ms cubic-bezier(0.33333, 0, 0.66667, 0.33333)",i.style.transform="translateY("+a+"px)",await M(l,()=>{i.setAttribute("style","position: relative;")})}}app.nextChecker.classList.toggle("player1"),app.nextChecker.classList.toggle("player2"),app.nextChecker.style.opacity="1",await G()},z=async e=>{state.isDropping||(A(app.gameStart),e.target.dataset.start==="ai"&&(state.setAiPlayers("player1","player2"),state.setDebug()),globalThis.loadGame&&await F(globalThis.loadGame),state.isPlayerAi&&v(x()))},U=async()=>{app.nextChecker.classList.replace("player2","player1"),app.columns.style.top="0px";const e=Math.round(window.outerHeight+window.outerHeight/2);D(app.columns,{transform:"translateY("+e+"px)"},e/2.5,"cubic-bezier(0.33333, 0, 0.66667, 0.33333)").then(()=>{app.columns.style.transform="",app.columns.style.transition="",app.columns.style.top="0px",[...app.columns.children].forEach(t=>t.innerHTML=""),A(app.gameOver),A(app.gameTie),state.reset(),state.isPlayerAi&&v(x())})};function $(e){app.nextChecker.style.left=e*app.size.clientWidth+"px"}function j(e,t,n){return e!=null}function L(e,t=250){var i;e.classList.add("show");const s=Array.from(e.querySelectorAll("[data-show]")).map((a,o)=>({element:a,index:parseInt(a.getAttribute("data-show")||"0",10)||o})).sort((a,o)=>a.index-o.index);(i=s.shift())==null||i.element.classList.add("show");const r=setInterval(()=>{var a;if(!s.length){clearInterval(r);return}(a=s.shift())==null||a.element.classList.add("show")},t)}const H=async e=>{const t=state.availableY(e.x);if(typeof t!="number")throw new Error("Invalid move: "+JSON.stringify(t));E(e),state.addPlay(e),await M(300)},F=async e=>{for(const t of e)await H(t);state.isPlayerAi&&v(x())};function X(e){const t=[];let n={},s=0,r="player1",i=!1,a=e.aiPlayers;return{setAiPlayers(...o){a=o},get debug(){return!!i},setDebug(){i=!0},togglePlayer(){r=r==="player1"?"player2":"player1"},reset(){t.length=0,n={},s=0,r="player1"},get isPlayerAi(){return a.includes(r)},get plays(){return[...t]},dropping(o=!0){s=s+(o?1:-1)},get isDropping(){return s>0},get player(){return r},get playsLength(){return t.length},addPlay({x:o,y:l,player:c}){t.push({x:o,y:l,player:c}),n[o]=n[o]||{},n[o][l]=t.length-1},at(o){return o<0?t[t.length+o]:t[o]},getPlay(o,l){var c;return n?t[(c=n[o])==null?void 0:c[l]]:null},availableY(o){const l=Object.keys(n[o]||{}).length;return l<b?l:null}}}function J(){globalThis.state=X({aiPlayers:["player2"]});const e=document.querySelector("#board .columns"),t=globalThis.app={debug:!1,board:document.querySelector("#board"),columns:e,size:document.querySelector("#size"),gameOver:document.querySelector("#game-over"),gameTie:document.querySelector("#game-tie"),gameStart:document.querySelector("#game-start"),restartButtons:Array.from(document.querySelectorAll("[data-restart]")),startButtons:Array.from(document.querySelectorAll("[data-start]")),buttons:Array.from(document.querySelectorAll("#board button")),spacesWrapper:Array.from(document.querySelectorAll("#board .spaces")),winMessage:document.querySelector("#win-message"),nextChecker:document.querySelector("#board .next .checker"),column:[...e.children]};t.column.forEach((n,s)=>{n.addEventListener("click",()=>W(s)),n.addEventListener("mouseover",()=>$(s))}),t.startButtons.forEach(n=>n.addEventListener("click",z)),t.restartButtons.forEach(n=>n.addEventListener("click",U)),L(t.gameStart)}addEventListener("load",J);
