(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const k={human:"You have won human!",robot:"Humans drool, robots rule!"},M=6,O=7,A=[{name:"top to bottom",points:[[0,3],[0,2],[0,1],[0,0],[0,-1],[0,-2],[0,-3]]},{name:"left to right",points:[[-3,0],[-2,0],[-1,0],[0,0],[1,0],[2,0],[3,0]]},{name:"top left to bottom right",points:[[-3,3],[-2,2],[-1,1],[0,0],[1,-1],[2,-2],[3,-3]]},{name:"bottom left to top right",points:[[-3,-3],[-2,-2],[-1,-1],[0,0],[1,1],[2,2],[3,3]]}],E=(e,t)=>e>=0&&e<O&&t>=0&&t<M;globalThis.aiLog=[];const d={unavailable:"u",occupied:"o",available:"a",next:"n",outOfBounds:"x"},C={match4:["aooo","oooa","oaoo","ooao"],match3:["aoo","ooa","oao"],match2:["ao","oa"],match4Next:["nooo","ooon","onoo","oono"],match3Next:["noo","oon","ono"],match2Next:["no","on"]},P=[{key:"match4",type:"offensive",value:100},{key:"match4",type:"defensive",value:90},{key:"match3",type:"defensive",value:80},{key:"match3",type:"offensive",value:70},{key:"match2",type:"offensive",value:60},{key:"match2",type:"defensive",value:50},{key:"match3Next",type:"defensive",value:-1},{key:"match4Next",type:"offensive",value:-1}];function L(){const e=Array.from({length:O},(o,s)=>state.availableY(s)),t=o=>{const s={goodMoves:[],badMoves:[]},l=(o==null?void 0:o.player)===state.player?"offensive":"defensive";if(!o)return s;for(const y of A){let f="",v=[];y.points.forEach(([h,b])=>{const[c,u]=[o.x+h,o.y+b];v.push(c),f+=(()=>{var m;if(!E(c,u))return d.outOfBounds;if(((m=state.getPlay(c,u))==null?void 0:m.player)===o.player)return d.occupied;const p=e[c];return p===u?d.available:p!==null&&p+1===u?d.next:d.unavailable})()});for(const{key:h,value:b}of P.filter(c=>c.type===l))for(const c of C[h]){const u=f.indexOf(c);if(u==-1)continue;let p=c.indexOf(d.available),m=c.indexOf(d.next);if(p>-1){const g=u+p;s.goodMoves.push({value:b,x:v[g],name:h,type:l,extra:{encoding:f,aIndex:p,matchIndex:u,availablePoint:g,xPoints:v}})}if(m>-1){const g=u+m;s.badMoves.push({x:v[g],name:h,type:l,extra:{encoding:f,aIndex:p,matchIndex:u,xToAvoid:g}})}}}return s};if(!e.filter(U).length)throw new Error("No available moves");const n=[],r=[];if(state.plays.forEach(o=>{const s=t(o);n.push(...s.goodMoves),r.push(...s.badMoves)}),n.sort((o,s)=>s.value-o.value),n.length===0){const o=e.reduce((l,y,f)=>(y!==null&&l.push(f),l),[]),s=I(0,o.length-1);return o[s]}const a=n.find(o=>!r.some(s=>s.x===o.x));if(a)return a.x;const i=e.find(o=>o!==null&&!n.some(s=>s.x===o));return console.log("bestAvailableY",i),i||(console.log("goodMoves",n),n[0].x)}async function q(e,t,n,r){return new Promise(a=>{const i=Object.keys(t).map(o=>`${o} ${Math.round(n)}ms ${r}`).join(",");e.style.transition=i,setTimeout(()=>{Object.assign(e.style,t)},1),setTimeout(()=>{e.style.transition="",a()},n+50)})}async function N(e,t){return new Promise(n=>{setTimeout(()=>{t==null||t(),n()},e)})}function I(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}function x(...e){e.forEach(t=>t.classList.remove("show"))}function Y(){let e=[];for(const t of A){e=[];const n=state.at(-1);for(const[r,[a,i]]of t.points.entries()){const[o,s]=[n.x+a,n.y+i],l=state.getPlay(o,s);if((l==null?void 0:l.player)===n.player){if(e.push(l),e.length===4)return e}else{const y=t.points.length-r-1;if(e=[],y<4)continue}}}return null}const D=()=>state.playsLength===64,T=({x:e,y:t})=>`c-${e}-${t}`,B=async()=>{const e=Y();return e?(app.winMessage.innerText=k[state.isPlayerAi?"robot":"human"],e.forEach(t=>{var n;(n=document.querySelector("#"+T(t)))==null||n.classList.add("blink")}),await N(2e3),w(app.gameOver),!0):D()?(w(app.gameTie),!0):(state.togglePlayer(),state.dropping(!1),state.isPlayerAi&&S(L()),!1)};async function R(e){state.isDropping||state.isPlayerAi||await S(e)}const S=async e=>{if(state.isDropping)return;const t=state.availableY(e);if(typeof t!="number")throw new Error("Invalid move: "+JSON.stringify(t));state.dropping(!0);const n=app.nextChecker.getBoundingClientRect().top;app.nextChecker.style.opacity="0",state.addPlay(e,t,state.player);{const r=app.nextChecker.cloneNode(!0);app.column[e].appendChild(r),r.setAttribute("style",""),r.id=T({x:e,y:t});const a=r.offsetTop+r.getBoundingClientRect().height;r.style.top=n+"px",r.style.position="fixed";const o=(Math.abs(t-M)+1)*75;r.style.transition="all "+o+"ms cubic-bezier(0.33333, 0, 0.66667, 0.33333)",r.style.transform="translateY("+a+"px)",await N(o,()=>{r.setAttribute("style","position: relative;")})}app.nextChecker.classList.toggle("player1"),app.nextChecker.classList.toggle("player2"),app.nextChecker.style.opacity="1",await B()},_=()=>{state.isDropping||(x(app.gameStart),state.isPlayerAi&&S(L()))},W=async()=>{app.nextChecker.classList.replace("player2","player1"),app.columns.style.top="0px";const e=Math.round(window.outerHeight+window.outerHeight/2);q(app.columns,{transform:"translateY("+e+"px)"},e/2.5,"cubic-bezier(0.33333, 0, 0.66667, 0.33333)").then(()=>{app.columns.style.transform="",app.columns.style.transition="",app.columns.style.top="0px",[...app.columns.children].forEach(t=>t.innerHTML=""),x(app.gameOver),x(app.gameTie),state.reset()})};function z(e){app.nextChecker.style.left=e*app.size.clientWidth+"px"}function U(e,t,n){return e!=null}function w(e,t=500){var i;e.classList.add("show");const r=Array.from(e.querySelectorAll("[data-show]")).map((o,s)=>({element:o,index:parseInt(o.getAttribute("data-show")||"0",10)||s})).sort((o,s)=>o.index-s.index);(i=r.shift())==null||i.element.classList.add("show");const a=setInterval(()=>{var o;if(!r.length){clearInterval(a);return}(o=r.shift())==null||o.element.classList.add("show")},t)}function $(e){const t=[];let n={},r=0,a="player1";return{debug:!1,togglePlayer(){a=a==="player1"?"player2":"player1"},reset(){t.length=0,n={},r=0,a="player1"},get isPlayerAi(){return e.includes(a)},get plays(){return[...t]},dropping(o=!0){r=r+(o?1:-1)},get isDropping(){return r>0},get player(){return a},get playsLength(){return t.length},addPlay(o,s,l){t.push({x:o,y:s,player:l}),n[o]=n[o]||{},n[o][s]=t.length-1},at(o){return o<0?t[t.length+o]:t[o]},getPlay(o,s){var l;return n?t[(l=n[o])==null?void 0:l[s]]:null},availableY(o){const s=Object.keys(n[o]||{}).length;return s<M?s:null}}}function j(){globalThis.state=$(["player2"]);const e=document.querySelector("#board .columns"),t=globalThis.app={board:document.querySelector("#board"),columns:e,size:document.querySelector("#size"),gameOver:document.querySelector("#game-over"),gameTie:document.querySelector("#game-tie"),gameStart:document.querySelector("#game-start"),restartButtons:Array.from(document.querySelectorAll("[data-restart]")),startButton:document.querySelector("#start-btn"),buttons:Array.from(document.querySelectorAll("#board button")),spacesWrapper:Array.from(document.querySelectorAll("#board .spaces")),winMessage:document.querySelector("#win-message"),nextChecker:document.querySelector("#board .next .checker"),column:[...e.children]};t.column.forEach((n,r)=>{n.addEventListener("click",()=>R(r)),n.addEventListener("mouseover",()=>z(r))}),t.startButton.addEventListener("click",_),t.restartButtons.forEach(n=>n.addEventListener("click",W)),w(t.gameStart)}addEventListener("load",j);
